<!DOCTYPE html>
<html>
  <head>
    <title>Custom navigation transition – Guntis Treulands – Blog about swift coding</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Different ways to implement custom navigation transitions, with some examples." />
    <meta property="og:description" content="Different ways to implement custom navigation transitions, with some examples." />
    
    <meta name="author" content="Guntis Treulands" />

    
    <meta property="og:title" content="Custom navigation transition" />
    <meta property="twitter:title" content="Custom navigation transition" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Guntis Treulands - Blog about swift coding" href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <!-- <a href="/" class="site-avatar"><img src="http://static1.squarespace.com/static/558def25e4b0fc259f066636/5a49786bf9619ae3bb6a2564/5b68eeacaa4a99da3bcdc610/1545107487365/Swift_logo.png" /></a> -->

          <div class="site-info">
            <h1 class="site-name"><a href="/">Guntis Treulands</a></h1>
            <p class="site-description">Blog about swift coding</p>
          </div>

           <nav>
            <!-- <a href="/swift">Swift</a> -->
            <!-- <a href="/experiments">Experiments</a> -->
            <a href="/about">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <center><z class="date">September 11, 2019</z></center>

<article class="post">
  <center><h1>Custom navigation transition</h1></center>
  
  <center><z class="excerpt">4 minutes read</z></center>
  <br> <br> <br>
  <div class="entry">
    <h2 id="requirement">Requirement</h2>

<p>By default, iOS provides us with a nice navigation transition. But custom transitions, if done properly, can achieve even more. They could make the transition more smooth, as if you never left previous view and it just transformed.</p>

<p>Custom navigation transition could be universal for all your app transitions, or unique for a certain steps.</p>

<p>And that will be the topic of this post - we have a requirement, to make one transition in our app in a custom way.</p>

<p><img srcset="/assets/2019-9-11-final_app_animation.gif 1x" /></p>

<h2 id="custom-navigation-transitions-types">Custom navigation transitions types</h2>

<p>There are 2 ways to implement custom navigation transitions:</p>

<p>1.) Using screenshots of UIViewControllers/UIViews/subviews;<br />
2.) Using actual UIViews;</p>

<h6 id="1-using-screenshots">1.) Using screenshots</h6>

<p>▸ One of the ways is to use screenshots of the previous view and next view. 
Then you can simply make any transformations you want, by positioning them and transforming with animations. For most transitions this could be more than enough.</p>

<center><a href="https://www.raywenderlich.com/322-custom-uiviewcontroller-transitions-getting-started">Dog app demo</a></center>
<p><img srcset="https://koenig-media.raywenderlich.com/uploads/2015/07/interactive.gif 1.5x" /></p>

<center><a href="https://www.raywenderlich.com/2925473-ios-animation-tutorial-custom-view-controller-presentation-transitions">Food list demo</a></center>
<p><img srcset="https://koenig-media.raywenderlich.com/uploads/2019/04/AnimationTour.gif 3x" /></p>

<center><a href="https://medium.com/swift2go/simple-custom-uinavigationcontroller-transitions-fdb56a217dd8">Simple transition demo</a></center>
<p><img srcset="https://miro.medium.com/max/1012/1*Gq73D_XGicqIKX5oGwKOpg.gif 2.1x" /></p>

<center><a href="https://github.com/PierrePerrin/PPBlurModalPresentation">Blur fade demo</a></center>
<p><img srcset="https://i.stack.imgur.com/ESSfI.gif 1.1x" /></p>

<p>▸ You could cut up a screenshot (like cut out a part where a UITableViewCell is located, or an icon), and then translate it to a different position, while changing background.</p>
<center><a href="http://dativestudios.com/blog/2013/09/29/interactive-transitions/">Animals list demo</a></center>
<p><img srcset="/assets/2019-9-11-example_animation_1.gif 1.3x" /></p>

<p>▸ You could cut up a view in many parts, and make it foldable.</p>
<center><a href="https://dribbble.com/shots/1041852-Fold-Effect-animation">Foldable view demo</a></center>
<p><img srcset="https://cdn.dribbble.com/users/14356/screenshots/1041852/dribble.gif 1.5x" /></p>

<p>▸ Or you could take the screenshots of separate subviews (textfields, imageview, etc) in next viewController, and transform/translate them:</p>
<center><a href="https://medium.com/rosberryapps/tricky-uiviewcontroller-transition-animations-59131b540b33 ">Subview screenshots demo</a></center>
<p><img srcset="https://miro.medium.com/max/374/1*CIaGezfg07JoX5REfzsI_A.gif 1.5x" /></p>

<p>As you can see, if the transformation is done without changing imageView aspect ratio, then it looks good enough! But if the aspect ratio is changed (for example scale up from square icon size to phone rectangle size), then it’s not so beautiful anymore.</p>

<h6 id="2-using-actual-views">2.) Using actual views</h6>

<p>Another possibility is to use actual views from next/previous viewcontrollers and animate their transition/transformation. Again - there are many possibilities how to deal with this, which mostly depends on how you want your custom transition to be like (what exactly to animate). But this then gives us a way to deal with aspect ratios, and make the transitions/animations more robust.</p>

<center><a href="https://devsign.co/notes/navigation-transitions-1">Gallery demo</a></center>
<p><img srcset="/assets/2019-9-11-actual_views_custom_transition_example.gif 1.25x" /></p>

<center><a href="https://medium.com/@aunnnn/making-app-store-today-ios-11-custom-transition-part-1-presentation-9e4ef99e75d3">AppStore animation demo</a></center>
<p><img srcset="https://miro.medium.com/max/600/1*dmXB3EfjnqJvWXABcPWIlA.gif 2.3x" /></p>

<h2 id="solution">Solution</h2>

<p>In this article, we will focus on using actual UIViews - when selecting a tableview cell, transform it into a different view, while changing background to a new view.</p>

<p><img srcset="/assets/2019-9-11-target_animation.png 1.5x" /></p>

<p>To do it, let’s split the custom animation in steps, to know exactly what is happening:</p>

<p>1.) User taps on a tableview cell.<br />
2.) Selected cell remains in that position, while the tableview in background fades out, and next viewcontroller (map), starts to fade in.<br />
3.) Shortly after tableview starts to fade out, selected cell starts to move to bottom, and at the same time - transform into a different layout (bigger title, bigger icon, icon centered at the top of the new view)<br />
4.) Transition ends with the cell fully transformed into different layout.</p>

<p><img srcset="/assets/2019-9-11-target_animation_middle_steps2.png 1.5x" /></p>

<p>To implement these steps, I created a reusable view, which will be used as a contentView for UITableViewCell and could be added as a subview in map viewController.</p>

<p><img srcset="/assets/2019-9-11-reused_table_view_cell.png 1.5x" /></p>

<p>Then I just need to position it at the selected cell position and fill it with the cell data.</p>

<p><img srcset="/assets/2019-9-11-next_view_controller_reused_view_appearing.png 1.5x" /></p>

<p>For the final step (transforming the reusable view into a different layout) I created a new view - <code class="highlight">expandedView</code>, that ads our reusable view as a subview. Then just enable/disable necessary layout constraints and constants - to switch between collapsed and expanded type.</p>

<p>For the expanded view - all the “cell” elements (except imageView) are faded out, and only image view is just transformed which will give use the feeling of “layout transformation”, instead of just view switching.</p>

<p><img srcset="/assets/2019-9-11-slow_animation.gif" />
<br /></p>

<h2 id="code">Code</h2>

<p>From the code perspective, it is pretty simple. For a custom navigation transition, you need a transition coordinator and transition animators (push/pop).</p>

<p>I ended up splitting transition animators into two separate classes - so that each class would contain only the necessary code for that specific transition type (push or pop), but the negative side is - I will have some duplicate code in my project.</p>

<h6 id="1-transitioncoordinator">1.) TransitionCoordinator</h6>

<p><code class="highlight">TransitionCoordinator</code> will add actual transition animators, when the transition will start to happen (either push or pop), it can also add swipe recogniser and implement <code class="highlight">UIPercentDrivenInteractiveTransition()</code>, which enables user to drag-to-dismiss in an interactive way. (Our custom navigation transition animation is percent driven).</p>

<pre class="splash"><code><span class="keyword">class</span> TransitionCoordinator: <span class="type">NSObject</span>, <span class="type">UINavigationControllerDelegate</span> {
    <span class="keyword">var</span> interactionController: <span class="type">UIPercentDrivenInteractiveTransition</span>?
    <span class="keyword">var</span> sideSwipeRecognizerAdded: <span class="type">Bool</span> = <span class="keyword">false
    weak var</span> navController: <span class="type">UINavigationController</span>?

    <span class="keyword">func</span> navigationController(<span class="keyword">_</span> navigationController: <span class="type">UINavigationController</span>,
        animationControllerFor operation: <span class="type">UINavigationController</span>.<span class="type">Operation</span>, from 
        fromVC: <span class="type">UIViewController</span>, to toVC: <span class="type">UIViewController</span>) -&gt; 
        <span class="type">UIViewControllerAnimatedTransitioning</span>? {

        <span class="keyword">if</span> !sideSwipeRecognizerAdded {
            navController = navigationController
            <span class="keyword">self</span>.<span class="call">addSideSwipeRecognizerToNavigationController</span>()
            sideSwipeRecognizerAdded = <span class="keyword">true</span>
        }

        <span class="keyword">switch</span> operation {
            <span class="keyword">case</span> .<span class="dotAccess">push</span>:
                <span class="keyword">return</span> <span class="type">PushTransitionAnimator</span>()
            <span class="keyword">case</span> .<span class="dotAccess">pop</span>:
                <span class="keyword">return</span> <span class="type">PopTransitionAnimator</span>()
            <span class="keyword">default</span>:
                <span class="keyword">return nil</span>
        }
    }

    <span class="keyword">func</span> navigationController(<span class="keyword">_</span> navigationController: <span class="type">UINavigationController</span>, 
        interactionControllerFor animationController: 
        <span class="type">UIViewControllerAnimatedTransitioning</span>) -&gt; 
        <span class="type">UIViewControllerInteractiveTransitioning</span>? {
        <span class="keyword">return</span> interactionController
    }

    <span class="comment">// MARK: Functions</span>

    <span class="keyword">func</span> addSideSwipeRecognizerToNavigationController() {
        <span class="keyword">let</span> edgeSwipeGestureRecognizer = <span class="type">UIScreenEdgePanGestureRecognizer</span>(target: 
            <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(<span class="call">handleSwipe</span>(<span class="keyword">_</span>:)))
        edgeSwipeGestureRecognizer.<span class="property">edges</span> = .<span class="dotAccess">left</span>
        navController!.view.<span class="call">addGestureRecognizer</span>(edgeSwipeGestureRecognizer)
    }

    <span class="keyword">@objc func</span> handleSwipe(<span class="keyword">_</span> gestureRecognizer: <span class="type">UIScreenEdgePanGestureRecognizer</span>) {

        <span class="keyword">let</span> percent = gestureRecognizer.<span class="call">translation</span>(in: gestureRecognizer.<span class="property">view</span>!).x 
        / gestureRecognizer.<span class="property">view</span>!.bounds.<span class="property">size</span>.<span class="property">width</span>

        <span class="keyword">if</span> gestureRecognizer.<span class="property">state</span> == .<span class="dotAccess">began</span> {
            interactionController = <span class="type">UIPercentDrivenInteractiveTransition</span>()
            navController!.<span class="call">popViewController</span>(animated: <span class="keyword">true</span>)
        } <span class="keyword">else if</span> gestureRecognizer.<span class="property">state</span> == .<span class="dotAccess">changed</span> {
            interactionController?.<span class="call">update</span>(percent)
        } <span class="keyword">else if</span> gestureRecognizer.<span class="property">state</span> == .<span class="dotAccess">ended</span> {
            <span class="keyword">if</span> percent &gt; <span class="number">0.5</span> &amp;&amp; gestureRecognizer.<span class="property">state</span> != .<span class="dotAccess">cancelled</span> {
                interactionController?.<span class="call">finish</span>()
            } <span class="keyword">else</span> {
                interactionController?.<span class="call">cancel</span>()
            }
            interactionController = <span class="keyword">nil</span>
        }
    }
}
</code></pre>

<h6 id="2-pushtransitionanimator">2.) PushTransitionAnimator</h6>

<p>To deal with animations, I decided to keep them out of animators, and instead call protocol methods on ViewControllers that implement them. That way, animators don’t have to worry about what to animate, and make them a bit more universal.</p>

<p>So- when animator is ready to transition, it will call <code class="highlight">reveal(withDuration:completionHandler:)</code> and complete the transition, when handler is returned.</p>

<p>Only thing that is animated within animator - is the previous viewController view. I wanted it to be faded out faster.</p>

<pre class="splash"><code><span class="keyword">protocol</span> PushTransitionAnimatorHelperProtocol: <span class="keyword">class</span> {
    <span class="comment">// Use this to animate necessary stuff. 
    // Return completionHandler when done.</span>
        <span class="keyword">func</span> reveal(withDuration duration: <span class="type">TimeInterval</span>, 
            completionHandler: <span class="keyword">@escaping</span> ((<span class="type">TransitionResult</span>&lt;<span class="type">Bool</span>&gt;) -&gt; <span class="type">Void</span>))
}

<span class="keyword">class</span> PushTransitionAnimator: <span class="type">NSObject</span>, <span class="type">UIViewControllerAnimatedTransitioning</span> {
	
    <span class="keyword">weak var</span> context: <span class="type">UIViewControllerContextTransitioning</span>?

    <span class="keyword">func</span> transitionDuration(using transitionContext: 
    	<span class="type">UIViewControllerContextTransitioning</span>?) -&gt; <span class="type">TimeInterval</span> {
        <span class="keyword">return</span> <span class="number">0.6</span>
    }

    <span class="keyword">func</span> animateTransition(using transitionContext: 
    	<span class="type">UIViewControllerContextTransitioning</span>) {
    	context = transitionContext

        <span class="keyword">guard let</span> fromView = transitionContext.<span class="call">view</span>(forKey: .<span class="dotAccess">from</span>),
			 <span class="keyword">let</span> toView = transitionContext.<span class="call">view</span>(forKey: .<span class="dotAccess">to</span>),
			 <span class="keyword">let</span> toViewController = transitionContext.<span class="call">viewController</span>(forKey: .<span class="dotAccess">to</span>) <span class="keyword">as</span>? <span class="type">PushTransitionAnimatorHelperProtocol</span>  <span class="keyword">else</span> { <span class="keyword">return</span> }

        <span class="comment">// Get the duration, that was declared in transitionDuration()</span>
        <span class="keyword">let</span> duration = <span class="call">transitionDuration</span>(using: transitionContext)

        <span class="keyword">let</span> container = transitionContext.<span class="property">containerView</span>
        container.<span class="call">addSubview</span>(toView)
        fromView.<span class="property">alpha</span> = <span class="number">1</span>

        <span class="comment">// This is just a tiny extra animation, 
        // to hide view that will appear - to hide it faster.</span>
        <span class="type">UIView</span>.<span class="call">animate</span>(withDuration: duration/<span class="number">2</span>, delay: <span class="number">0</span>, 
            usingSpringWithDamping: <span class="number">0.7</span>, initialSpringVelocity: <span class="number">0.2</span>,
            options: [.<span class="dotAccess">curveEaseInOut</span>], animations: {
            fromView.<span class="property">alpha</span> = <span class="number">0</span>
        })

        toViewController.<span class="call">reveal</span>(withDuration: duration) { status <span class="keyword">in</span> 
            transitionContext.<span class="call">completeTransition</span>(!transitionContext.<span class="property">transitionWasCancelled</span>)
        }
    }
}
</code></pre>

<h6 id="3-poptransitionanimator">3.) PopTransitionAnimator</h6>

<p>Similarly as with <code class="highlight">PushTransitionAnimator</code>, there are protocols, that need to be implemented in necessary ViewControllers.</p>

<p><code class="highlight">PopTransitionAnimatorHelperProtocol</code> <code class="highlight">hide(withDuration:completionHandler:)</code> is meant for pop animation,to animate any views, to return to original positions etc, and <code class="highlight">reset()</code> will be called, if user drags-to-pop viewController, but cancels it.</p>

<p>But<code class="highlight">PopTransitionAnimatorFinaliseHelperProtocol</code> is meant to be implemented by previousViewController - the one we initially started this custom transition from. 
In my case, I use this method to unhide UITableViewCell which was tapped.</p>

<pre class="splash"><code><span class="keyword">protocol</span> PopTransitionAnimatorHelperProtocol: <span class="keyword">class</span> {
    <span class="comment">// Use this to animate necessary stuff. Return completionHandler when done.</span>
    <span class="keyword">func</span> hide(withDuration duration: <span class="type">TimeInterval</span>, 
        completionHandler: <span class="keyword">@escaping</span> ((<span class="type">TransitionResult</span>&lt;<span class="type">Bool</span>&gt;) -&gt; <span class="type">Void</span>))

    <span class="comment">// Used when user manually swipes back, but cancels it.</span>
    <span class="keyword">func</span> reset()
}

<span class="keyword">protocol</span> PopTransitionAnimatorFinaliseHelperProtocol: <span class="keyword">class</span> {
    <span class="comment">// Called on toViewController - to finalise any tasks (like, unhide item)</span>
    <span class="keyword">func</span> customTransitionWasFinished()
}

<span class="keyword">class</span> PopTransitionAnimator: <span class="type">NSObject</span>, <span class="type">UIViewControllerAnimatedTransitioning</span> {

    <span class="keyword">weak var</span> context: <span class="type">UIViewControllerContextTransitioning</span>?
    <span class="keyword">weak var</span> fromViewController: <span class="type">PopTransitionAnimatorHelperProtocol</span>?

    <span class="keyword">func</span> transitionDuration(using transitionContext: 
        <span class="type">UIViewControllerContextTransitioning</span>?) -&gt; <span class="type">TimeInterval</span> {
        <span class="keyword">return</span> <span class="number">0.6</span>
    }

    <span class="keyword">func</span> animationEnded(<span class="keyword">_</span> transitionCompleted: <span class="type">Bool</span>) {
        <span class="keyword">if</span> !transitionCompleted {
            <span class="keyword">self</span>.<span class="property">fromViewController</span>?.<span class="call">reset</span>()
        }
    }

    <span class="keyword">func</span> animateTransition(using transitionContext: 
        <span class="type">UIViewControllerContextTransitioning</span>) {
        context = transitionContext
    
        <span class="keyword">guard let</span> fromView = transitionContext.<span class="call">view</span>(forKey: .<span class="dotAccess">from</span>),
			 <span class="keyword">let</span> toView = transitionContext.<span class="call">view</span>(forKey: .<span class="dotAccess">to</span>),
			 <span class="keyword">let</span> toViewController = transitionContext.<span class="call">viewController</span>(forKey: .<span class="dotAccess">to</span>) <span class="keyword">as</span>? <span class="type">PopTransitionAnimatorFinaliseHelperProtocol</span>,
			 <span class="keyword">let</span> fromViewController = transitionContext.<span class="call">viewController</span>(forKey: .<span class="dotAccess">from</span>) <span class="keyword">as</span>? <span class="type">PopTransitionAnimatorHelperProtocol</span> <span class="keyword">else</span> { <span class="keyword">return</span> }

        <span class="keyword">self</span>.<span class="property">fromViewController</span> = fromViewController

        <span class="keyword">let</span> duration = <span class="call">transitionDuration</span>(using: transitionContext)

        <span class="keyword">let</span> container = transitionContext.<span class="property">containerView</span>
        container.<span class="call">insertSubview</span>(toView, belowSubview: fromView)
        toView.<span class="property">alpha</span> = <span class="number">0</span>

        <span class="comment">// This is just a tiny extra animation, 
        // to un-hide view that will appear - faster</span>
        <span class="type">UIView</span>.<span class="call">animate</span>(withDuration: duration/<span class="number">2</span>, delay: <span class="number">0</span>, 
            usingSpringWithDamping: <span class="number">0.7</span>, initialSpringVelocity: <span class="number">0.2</span>,
            options: [.<span class="dotAccess">curveEaseInOut</span>], animations: {
            toView.<span class="property">alpha</span> = <span class="number">1</span>
        })

        fromViewController.<span class="call">hide</span>(withDuration: duration) { status <span class="keyword">in
            if</span> !transitionContext.<span class="property">transitionWasCancelled</span> {
                toViewController.<span class="call">customTransitionWasFinished</span>()
                container.<span class="call">addSubview</span>(toView)
            }
            transitionContext.<span class="call">completeTransition</span>(!transitionContext.<span class="property">transitionWasCancelled</span>)
        }
    }
}
</code></pre>

<h2 id="ps">P.S.</h2>

<p><a href="https://github.com/GuntisTreulands/CustomNavigationTransition">Full code / demo, can be found here</a></p>


  </div>

  <!-- <div class="date">
    Written on September 11, 2019
  </div> -->

  
</article>

    </div>
    <br>
    <div class="container">
    <div class="PageNavigation">
        
          
            <a class="totalRight" href="/custom_table_view_cells_with_xcode_image_alignment.html">Custom UITableViewCell with Xcode assets image alignment &raquo; </a>
          
        
        
      </div>
    </div>


    <!-- <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:gtreulands@gmail.com"><i class="svg-icon email"></i></a>


<a href="https://github.com/GuntisTreulands"><i class="svg-icon github"></i></a>

<a href="https://www.linkedin.com/in/guntis-t-325905161"><i class="svg-icon linkedin"></i></a>


<a href="https://www.twitter.com/gtreulands"><i class="svg-icon twitter"></i></a>
<a href="http://stackoverflow.com/users/894671/guntis-treulands"><i class="svg-icon stackoverflow"></i></a>


        </footer>
      </div>
    </div> -->
    <br><br>
    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-143179417-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/custom_navigation_transition.html',
		  'title': 'Custom navigation transition'
		});
	</script>
	<!-- End Google Analytics -->


  </body>
</html>
